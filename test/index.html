<html>
<head>
    <style>
        ul {
            list-style-type: none;
            padding: 10px;
        }

        ul.expression-builder-group {
            list-style-type: none;
            display: inline;
        }

        li {
            display: inline;
        }

        .bold {
            font-weight: bold;
        }
    </style>
</head>
<title>Test</title>
<body ng-app="app">

<h1>
    Test Expression Builder
</h1>

<div ng-controller="expressionsCtrl">
    <div eb-node="model.node">
    </div>
</div>

<script src="../bower_components/angular/angular.js"></script>
<script src="../dist/scripts.js"></script>
<script src="../dist/templates.js"></script>

<script language="javascript">
    var app = angular.module('app', ['expression-builder']);
    app.controller('expressionsCtrl', [
        'ExpressionNode',
        'ExpressionBuilder',
        '$scope',
        '$templateCache',
        function (ExpressionNode,
                  ExpressionBuilder,
                  $scope,
                  $templateCache) {

            $templateCache.put('label', '<label ng-class="expression.classes">{{expression.text}}</label>');
            $templateCache.put('input', '<input ng-model="expression.value" ng-change="expression.input($event);"/>');
            $templateCache.put('list', '<select ng-model="expression.selected" ng-change="expression.change()"><option ng-repeat="option in expression.options">{{option}}</option></select>');
            $templateCache.put('button', '<button ng-click="expression.click($event)">{{expression.text}}</button>');


            var node = new ExpressionNode();

            var builder =
                    new ExpressionBuilder([
                        {
                            type: 'label',
                            templateUrl: 'label'
                        },
                        {
                            type: 'input',
                            templateUrl: 'input'
                        },
                        {
                            type: 'list',
                            templateUrl: 'list'
                        },
                        {
                            type: 'button',
                            templateUrl: 'button'
                        }
                    ]);

            var schema =
                    builder.node('#logical-group', function (schema) {
                        schema.list('#logical-op-list', {
                                    options: ['AND', 'OR'],
                                    value: 'AND'
                                })
                                .button('#add-logical-group', {
                                    onClick: function (node, line) {
                                        node.addChild(node.clone());
                                        // Node level:
                                        // node.addChild
                                        // node.addBefore
                                        // node.addAfter
                                        // node.parent
                                        // node.level
                                        // node.index
                                        // node.remove
                                        // node.clone
                                        // node['#logical-group']
                                    }
                                })
                                .button('#remove-logical-group', {
                                    isVisible: function (node, line) {
                                        return node.level > 0;
                                    },
                                    onClick: function (node, line) {
                                        node.remove();
                                    }
                                })
                                .node('#condition-group', function (schema) {
                                    schema.attr('placeholder', true)
                                            .label({
                                                text: 'Field',
                                                classes: [{bold: !schema.attr('placeholder')}]
                                            })
                                            .list('#operator', {
                                                options: ['BETWEEN', 'EQUALS'],
                                                value: 'EQUALS',
                                                // TODO Binds to onChange and set placeholder to false
                                                placeholder: {'onChange': false},
                                                onChange: function (node, line) {
                                                    // Expression level
                                                    // put
                                                    // remove
                                                    // clone

                                                    var operand = line.get('#operand');
                                                    switch (this.value) {
                                                        case 'EQUALS':
                                                            line.put(operand, function (group) {
                                                                group.input();
                                                            });
                                                            break;
                                                        case 'BETWEEN':
                                                            line.put(operand, function (group) {
                                                                group.input()
                                                                        .label({text: 'AND'})
                                                                        .input();
                                                            });
                                                            break;

                                                    }

                                                }
                                            })
                                            .group('#operand')
                                            .button('#remove', {
                                                isVisible: function (node, line) {
                                                    return line.attr('placeholder');
                                                },
                                                onClick: function (node, line) {
                                                    node.remove();
                                                }
                                            })
                                })
                    });

            schema.apply(node);
            $scope.model = {node: node};
        }]);
</script>

</body>
</html>